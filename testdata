import string
from collections import defaultdict
import math

f = open('khanex-frequent.txt', 'r')

lines = [line for line in f]

last_seen = ''

common_answers  = defaultdict(list)

for line in lines:
    if last_seen == '':
        last_seen = line
    elif line == '\n':
        last_seen = ''
    else:
        common_answers[last_seen].append([int(line.split()[-1]), string.join(line.split()[:-1],'')])


commons = {}
request_string = ''
for d in common_answers:
    print d
    if True:
    if '-x' in d:
        id = d.strip().split('-')[-1]
        url ='/api/v1/assessment_items/%s/wrong_answers\n' % id
        request_string +=  url
        total_responses = sum([response[0] for response in common_answers[d]])
        print total_responses, 'is the number of total responses'
        request_string +='data={'
        for response in common_answers[d]:
            if float(response[0] * 100) / total_responses > 5:
                print float(response[0] * 100),
                print response[1]
                request_string += response[1].encode('ascii', 'ignore')
            if False:
                if float(response[0] * 100) / total_responses > 5:
                    request_string += '\n'
                    request_string += str(int(round(float(response[0] * 100) / total_responses)))
                    request_string += ':'
                    loaded_response = json.loads(response[1], "utf8")
                    while type(loaded_response) is list:
                        loaded_response = loaded_response[0]
                    if 'values' in loaded_response:
                        request_string += str(loaded_response['values'])
                    elif 'value' in loaded_response:
                        try:
                            request_string += str(loaded_response['value'])
                        except:
                            request_string += loaded_response['value'].encode('ascii', 'ignore')
                    elif 'currentValue' in loaded_response:
                        request_string += str(loaded_response['currentValue'])
                    else:
                        request_string += str(loaded_response)
            #except:
            #    pass
        request_string += '}\n'